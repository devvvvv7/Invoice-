<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Generator</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,AAABAAEAAQEAAAEAIAAwAAAAFgAAACgAAAABAAAAAgAAAAEAIAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA==">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        .slide-in {
            animation: slideIn 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-gradient-to-r from-blue-100 to-white flex items-center justify-center min-h-screen">
    <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-2xl transform transition-all duration-300 hover:shadow-3xl">
        <h1 class="text-3xl font-bold text-center text-indigo-700 mb-6 fade-in">Invoice Generator</h1>
        <form id="invoiceForm" class="space-y-6">
            <!-- Header Section -->
            <div class="border-b-2 border-indigo-200 pb-4 fade-in">
                <label for="companyName" class="block text-lg font-semibold text-gray-700">Company Name (Optional)</label>
                <input type="text" id="companyName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 transition duration-200" placeholder="e.g., Texture World">
                <label for="invoiceDate" class="block mt-2 text-lg font-semibold text-gray-700">Invoice Date</label>
                <input type="date" id="invoiceDate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 transition duration-200" value="2025-06-21" required>
            </div>

            <!-- Customer Details Section -->
            <div class="border-b-2 border-indigo-200 pb-4 fade-in" style="animation-delay: 0.2s">
                <h2 class="text-xl font-semibold text-indigo-600 mb-2">Customer Details</h2>
                <div>
                    <label for="clientName" class="block text-sm font-medium text-gray-700">Client's/Site Name</label>
                    <input type="text" id="clientName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 transition duration-200" required>
                </div>
            </div>

            <!-- Material Details Section -->
            <div class="pb-4 fade-in" style="animation-delay: 0.4s">
                <h2 class="text-xl font-semibold text-indigo-600 mb-2">Material Details</h2>
                <div id="materialsContainer" class="space-y-4">
                    <div class="grid grid-cols-6 gap-4 items-center font-semibold text-gray-700">
                        <span>S.No.</span>
                        <span>Material Type</span>
                        <span>Area (Sq.Ft)</span>
                        <span>Rate (Sq.Ft)</span>
                        <span>Amount</span>
                        <span>Action</span>
                    </div>
                    <div class="grid grid-cols-6 gap-4 items-center slide-in" data-row="0">
                        <span>01</span>
                        <select class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 transition duration-200" required>
                            <option value="Pla Tap">Pla Tap</option>
                            <option value="Plastic Wood">Plastic Wood</option>
                        </select>
                        <input type="number" min="0" step="0.01" class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 transition duration-200" required>
                        <input type="number" min="0" step="0.01" class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 transition duration-200" required>
                        <input type="text" class="w-full rounded-md border-gray-300 bg-gray-100 p-2" readonly>
                        <button type="button" onclick="deleteMaterialRow(this)" class="bg-red-600 text-white p-1 rounded-md hover:bg-red-700 transition duration-200">Delete</button>
                    </div>
                </div>
                <button type="button" onclick="addMaterialRow()" class="mt-2 bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition duration-200">Add Material</button>
            </div>

            <div class="fade-in" style="animation-delay: 0.6s">
                <label for="totalAmount" class="block text-lg font-medium text-gray-700">Total Amount</label>
                <input type="text" id="totalAmount" class="mt-1 block w-full rounded-md border-gray-300 bg-gray-100 p-2 text-xl font-semibold text-indigo-700" readonly>
            </div>
            <button type="button" onclick="generateInvoice()" class="w-full bg-indigo-600 text-white py-3 px-6 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 text-lg font-bold transition duration-300 transform hover:scale-105">Generate Invoice</button>
        </form>
    </div>

    <script>
        let invoiceCounter = 1;

        // Calculate total amount for each row
        document.addEventListener('input', function(e) {
            if (e.target.tagName === 'INPUT' && e.target.type === 'number') {
                const row = e.target.closest('[data-row]');
                if (row) {
                    const area = parseFloat(row.querySelectorAll('input')[0].value) || 0;
                    const rate = parseFloat(row.querySelectorAll('input')[1].value) || 0;
                    const amount = (area * rate).toFixed(2);
                    row.querySelectorAll('input')[2].value = `$${amount}`;
                    calculateTotal();
                }
            }
        });

        function addMaterialRow() {
            const container = document.getElementById('materialsContainer');
            const rows = container.querySelectorAll('[data-row]');
            const newIndex = rows.length;
            const newRow = document.createElement('div');
            newRow.className = 'grid grid-cols-6 gap-4 items-center slide-in';
            newRow.setAttribute('data-row', newIndex);
            newRow.innerHTML = `
                <span>${(newIndex + 1).toString().padStart(2, '0')}</span>
                <select class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 transition duration-200" required>
                    <option value="Pla Tap">Pla Tap</option>
                    <option value="Plastic Wood">Plastic Wood</option>
                </select>
                <input type="number" min="0" step="0.01" class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 transition duration-200" required>
                <input type="number" min="0" step="0.01" class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 transition duration-200" required>
                <input type="text" class="w-full rounded-md border-gray-300 bg-gray-100 p-2" readonly>
                <button type="button" onclick="deleteMaterialRow(this)" class="bg-red-600 text-white p-1 rounded-md hover:bg-red-700 transition duration-200">Delete</button>
            `;
            container.insertBefore(newRow, container.lastElementChild);
            newRow.style.animationDelay = `${0.1 * (newIndex + 1)}s`;
        }

        function deleteMaterialRow(button) {
            const row = button.closest('[data-row]');
            if (row) {
                row.classList.add('opacity-0');
                setTimeout(() => {
                    row.remove();
                    calculateTotal();
                    renumberRows();
                }, 300);
            }
        }

        function renumberRows() {
            const rows = document.querySelectorAll('[data-row]');
            rows.forEach((row, index) => {
                row.setAttribute('data-row', index);
                row.querySelector('span').textContent = (index + 1).toString().padStart(2, '0');
            });
        }

        function calculateTotal() {
            let total = 0;
            const rows = document.querySelectorAll('[data-row]');
            rows.forEach(row => {
                const amount = parseFloat(row.querySelectorAll('input')[2].value.replace('$', '')) || 0;
                total += amount;
            });
            document.getElementById('totalAmount').value = `$${total.toFixed(2)}`;
        }

        function generateInvoice() {
            try {
                const companyName = document.getElementById('companyName').value || 'TEXTURE WORLD';
                const invoiceDate = document.getElementById('invoiceDate').value;
                const clientName = document.getElementById('clientName').value;
                const totalAmount = parseFloat(document.getElementById('totalAmount').value.replace('$', '')) || 0;

                if (!clientName || !invoiceDate) {
                    alert('Please fill in all required fields.');
                    return;
                }

                if (!window.jspdf || !window.jspdf.jsPDF) {
                    alert('jsPDF library failed to load. Please try refreshing the page.');
                    console.error('jsPDF not loaded');
                    return;
                }

                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Auto-generate Invoice Number
                const invoiceNumber = `INV-${new Date(invoiceDate).getFullYear()}${String(new Date(invoiceDate).getMonth() + 1).padStart(2, '0')}${String(new Date(invoiceDate).getDate()).padStart(2, '0')}-${String(invoiceCounter++).padStart(3, '0')}`;

                // Header Section
                doc.setFontSize(20);
                doc.text(companyName, 70, 20);
                doc.setFontSize(12);
                doc.text('Address - 25, Vrindavan Garden, Near Scheme no-140, Piplyani, Indore', 50, 30);
                doc.text('Email - textureworldindia@gmail.com', 70, 40);
                doc.text(`Invoice Number: ${invoiceNumber}`, 20, 50);
                doc.text(`Date of Estimate: ${new Date(invoiceDate).toLocaleDateString('en-GB')}`, 20, 60);

                // Customer Details Section
                doc.setFontSize(12);
                doc.text(`Client's/Site Name: ${clientName}`, 20, 70);

                // Material Details Section
                const rows = document.querySelectorAll('[data-row]');
                let y = 80;
                doc.text('S.No.', 20, y);
                doc.text('Texture', 40, y);
                doc.text('Area (Sq.Ft)', 80, y);
                doc.text('Rate (Sq.Ft)', 120, y);
                doc.text('Amount', 160, y);
                y += 10;
                rows.forEach(row => {
                    const texture = row.querySelector('select').value;
                    const area = parseFloat(row.querySelectorAll('input')[0].value) || 0;
                    const rate = parseFloat(row.querySelectorAll('input')[1].value) || 0;
                    const amount = (area * rate).toFixed(2);
                    doc.text((rows.indexOf(row) + 1).toString().padStart(2, '0'), 20, y);
                    doc.text(texture, 40, y);
                    doc.text(`${area}`, 80, y);
                    doc.text(`$${rate.toFixed(2)}`, 120, y);
                    doc.text(`$${amount}`, 160, y);
                    y += 10;
                });
                doc.text('Total Amount', 160, y);
                doc.text(`$${totalAmount.toFixed(2)}`, 200, y);

                // Terms & Conditions
                doc.setFontSize(10);
                y += 10;
                doc.text('Terms & Conditions:', 20, y);
                y += 5;
                doc.text('1. This price includes Labour of Texture.', 20, y);
                y += 5;
                doc.text('2. Payment Schedule:', 20, y);
                y += 5;
                doc.text('   • 50% Advance', 30, y);
                y += 5;
                doc.text('   • 30% During Work in Progress', 30, y);
                y += 5;
                doc.text('   • 20% On Handover', 30, y);
                y += 5;
                doc.text('3. Scaffolding would be arranged by the Client in case of multiple floors.', 20, y);
                y += 5;
                doc.text('4. Final amount may vary as per actual measurement.', 20, y);

                // Client Signature
                y += 10;
                doc.text('Client Signature: ____________________', 20, y);

                // Save PDF
                doc.save(`Estimate_${invoiceNumber}_${clientName}_${new Date(invoiceDate).toLocaleDateString('en-GB').replace(/\//g, '-')}.pdf`);
                console.log('PDF generated successfully');
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('An error occurred while generating the PDF. Check the console for details.');
            }
        }
    </script>
</body>
</html>
